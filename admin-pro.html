<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - BullBear Trading</title>
    <link rel="shortcut icon" href="images/bullbear-logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .login-container {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 50px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo img {
            height: 80px;
            margin-bottom: 20px;
        }

        .login-logo h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #6366f1, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .login-logo p {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #94a3b8;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.5);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }


        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
        }

        /* Dashboard Layout */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .dashboard.active {
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-right: 1px solid rgba(99, 102, 241, 0.2);
            padding: 30px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-logo {
            padding: 0 30px;
            margin-bottom: 40px;
            text-align: center;
        }

        .sidebar-logo img {
            height: 60px;
            margin-bottom: 15px;
        }

        .sidebar-logo h2 {
            font-size: 1.3rem;
            background: linear-gradient(135deg, #6366f1, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 30px;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover {
            background: rgba(99, 102, 241, 0.1);
            color: #06b6d4;
            border-left-color: #06b6d4;
        }

        .sidebar-menu a.active {
            background: rgba(99, 102, 241, 0.15);
            color: #06b6d4;
            border-left-color: #06b6d4;
        }

        .sidebar-menu .icon {
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 30px;
            width: calc(100% - 280px);
        }

        /* Header */
        .header {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header-left p {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .live-time-widget {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .live-time {
            font-size: 1.1rem;
            font-weight: 700;
            color: #06b6d4;
            font-family: 'Courier New', monospace;
        }

        .live-date {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 2px;
        }

        .location-widget {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .location-icon {
            font-size: 1.2rem;
        }

        .location-text {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .location-city {
            font-weight: 600;
            color: #06b6d4;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #06b6d4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .admin-info {
            text-align: right;
        }

        .admin-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .admin-role {
            color: #94a3b8;
            font-size: 0.8rem;
        }

        .logout-btn {
            padding: 10px 20px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            font-size: 2.5rem;
        }

        .stat-trend {
            font-size: 0.85rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        .stat-trend.up {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .stat-trend.down {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #06b6d4;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            padding: 25px;
        }

        .chart-card h3 {
            color: #06b6d4;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        /* Table */
        .table-container {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            color: #06b6d4;
            font-size: 1.2rem;
        }

        .refresh-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(99, 102, 241, 0.1);
        }

        th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            color: #06b6d4;
            font-size: 0.9rem;
        }

        td {
            padding: 15px 20px;
            border-top: 1px solid rgba(99, 102, 241, 0.1);
        }

        tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Action Buttons */
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .btn-approve {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-reject {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-view {
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            color: white;
        }

        .btn-edit {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        /* Settings Form */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .settings-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            padding: 30px;
        }

        .settings-card h3 {
            color: #06b6d4;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .save-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        /* Profile Section */
        .profile-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #06b6d4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 700;
        }

        .profile-details h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .profile-details p {
            color: #94a3b8;
            font-size: 1rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-logo h2,
            .sidebar-menu span {
                display: none;
            }

            .sidebar-menu a {
                justify-content: center;
                padding: 15px;
            }

            .main-content {
                margin-left: 70px;
                width: calc(100% - 70px);
            }
            
            .live-time-widget,
            .location-widget {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-right {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .live-time-widget,
            .location-widget {
                display: flex;
            }

            .stats-grid,
            .charts-grid,
            .settings-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <img src="images/bullbear-logo.png" alt="BullBear Trading">
                <h1>Admin Dashboard</h1>
                <p>Master the Markets</p>
            </div>

            <div id="loginError" class="error-message"></div>

            <form id="loginForm" onsubmit="return handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="admin@bullbeartrading.com" required>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="login-btn">Login to Dashboard</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="images/bullbear-logo.png" alt="BullBear Trading">
                <h2>BullBear</h2>
            </div>

            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showSection('dashboard')"><span class="icon">üìä</span><span>Dashboard</span></a></li>
                <li><a href="#" onclick="showSection('analytics')"><span class="icon">üìà</span><span>Analytics</span></a></li>
                <li><a href="#" onclick="showSection('purchases')"><span class="icon">üõí</span><span>Purchases</span></a></li>
                <li><a href="#" onclick="showSection('users')"><span class="icon">üë•</span><span>Users</span></a></li>
                <li><a href="#" onclick="showSection('content')"><span class="icon">üìö</span><span>Content</span></a></li>
                <li><a href="#" onclick="showSection('emails')"><span class="icon">‚úâÔ∏è</span><span>Bulk Email</span></a></li>
                <li><a href="#" onclick="showSection('checklist')"><span class="icon">üìã</span><span>Checklist</span></a></li>
                <li><a href="#" onclick="showSection('settings')"><span class="icon">‚öôÔ∏è</span><span>Settings</span></a></li>
                <li><a href="#" onclick="showSection('profile')"><span class="icon">üë§</span><span>Profile</span></a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1 id="pageTitle">Dashboard Overview</h1>
                    <p id="pageSubtitle">Welcome back! Here's what's happening today.</p>
                </div>
                <div class="header-right">
                    <div class="live-time-widget">
                        <div class="live-time" id="liveTime">00:00:00</div>
                        <div class="live-date" id="liveDate">Loading...</div>
                    </div>
                    <div class="location-widget">
                        <span class="location-icon">üìç</span>
                        <div>
                            <div class="location-text">Location</div>
                            <div class="location-city" id="userLocation">Detecting...</div>
                        </div>
                    </div>
                    <div class="admin-profile">
                        <div class="admin-avatar" id="adminAvatar">A</div>
                        <div class="admin-info">
                            <div class="admin-name" id="adminName">Admin</div>
                            <div class="admin-role">Administrator</div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="content-section active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-trend up">‚Üë 12%</div>
                        </div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="totalUsers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üõí</div>
                            <div class="stat-trend up">‚Üë 8%</div>
                        </div>
                        <div class="stat-label">Total Purchases</div>
                        <div class="stat-value" id="totalPurchases">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">‚è≥</div>
                            <div class="stat-trend down">‚Üì 3%</div>
                        </div>
                        <div class="stat-label">Pending Approvals</div>
                        <div class="stat-value" id="pendingCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-trend up">‚Üë 15%</div>
                        </div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="totalRevenue">$0</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Revenue Overview</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>User Growth</h3>
                        <canvas id="userChart"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Recent Purchases</h3>
                        <button class="refresh-btn" onclick="loadDashboardData()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Course</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentPurchasesTable">
                            <tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üì¶</div><p>No recent purchases</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="content-section">
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Sales by Course</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Monthly Revenue</h3>
                        <canvas id="monthlyRevenueChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Purchase Status Distribution</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>User Registrations</h3>
                        <canvas id="registrationChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Purchases Section -->
            <div id="purchasesSection" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>All Purchases</h3>
                        <button class="refresh-btn" onclick="loadPurchases()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>User</th>
                                <th>Course</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="purchasesTable">
                            <tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üõí</div><p>No purchases yet</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users Section -->
            <div id="usersSection" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>All Users</h3>
                        <button class="refresh-btn" onclick="loadUsers()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Joined</th>
                                <th>Purchases</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üë•</div><p>No users yet</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Content Management Section -->
            <div id="contentSection" class="content-section">
                <!-- Add New Content -->
                <div class="settings-card" style="margin-bottom: 30px;">
                    <h3>üì§ Upload New Content</h3>
                    <form onsubmit="return addContent(event)">
                        <div class="form-group">
                            <label>Content Type</label>
                            <select id="contentType" style="width: 100%; padding: 14px 16px; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; background: rgba(15, 23, 42, 0.5); color: #ffffff; font-size: 1rem;">
                                <option value="video">üé• Video</option>
                                <option value="ebook">üìñ eBook</option>
                                <option value="document">üìÑ Document</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="contentTitle" placeholder="Enter content title" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" id="contentDescription" placeholder="Brief description">
                        </div>
                        <div class="form-group">
                            <label>URL / File Path</label>
                            <input type="text" id="contentUrl" placeholder="https://... or /path/to/file" required>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <input type="text" id="contentCategory" placeholder="e.g., Trading Basics, Advanced Strategies">
                        </div>
                        <div class="form-group">
                            <label>Duration / Pages (optional)</label>
                            <input type="text" id="contentDuration" placeholder="e.g., 45 min or 120 pages">
                        </div>
                        <button type="submit" class="save-btn">‚ûï Add Content</button>
                    </form>
                </div>

                <!-- Content Tabs -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(99, 102, 241, 0.2);">
                    <button class="tab active" onclick="filterContent('all')" style="padding: 15px 30px; background: transparent; border: none; color: #94a3b8; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; border-bottom: 3px solid transparent;">All Content</button>
                    <button class="tab" onclick="filterContent('video')" style="padding: 15px 30px; background: transparent; border: none; color: #94a3b8; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; border-bottom: 3px solid transparent;">üé• Videos</button>
                    <button class="tab" onclick="filterContent('ebook')" style="padding: 15px 30px; background: transparent; border: none; color: #94a3b8; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; border-bottom: 3px solid transparent;">üìñ eBooks</button>
                    <button class="tab" onclick="filterContent('document')" style="padding: 15px 30px; background: transparent; border: none; color: #94a3b8; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; border-bottom: 3px solid transparent;">üìÑ Documents</button>
                </div>

                <!-- Content List -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Content Library</h3>
                        <button class="refresh-btn" onclick="loadContent()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Duration/Pages</th>
                                <th>Added</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contentTable">
                            <tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üìö</div><p>No content yet. Add your first video, ebook, or document above!</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Bulk Email Section -->
            <div id="emailsSection" class="content-section">
                <!-- Email Composer -->
                <div class="settings-card" style="margin-bottom: 30px;">
                    <h3>‚úâÔ∏è Compose Bulk Email</h3>
                    <form onsubmit="return sendBulkEmail(event)">
                        <div class="form-group">
                            <label>Recipients</label>
                            <select id="emailRecipients" style="width: 100%; padding: 14px 16px; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; background: rgba(15, 23, 42, 0.5); color: #ffffff; font-size: 1rem;">
                                <option value="all">üìß All Users</option>
                                <option value="buyers">üõí Users with Purchases</option>
                                <option value="checklist">üìã Checklist Subscribers</option>
                                <option value="custom">‚úèÔ∏è Custom Email List</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="customEmailsGroup" style="display: none;">
                            <label>Custom Email Addresses (comma-separated)</label>
                            <textarea id="customEmails" placeholder="email1@example.com, email2@example.com, email3@example.com" style="width: 100%; padding: 14px 16px; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; background: rgba(15, 23, 42, 0.5); color: #ffffff; font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="emailSubject" placeholder="Enter email subject" required>
                        </div>

                        <div class="form-group">
                            <label>Email Message</label>
                            <textarea id="emailMessage" placeholder="Write your email message here..." required style="width: 100%; padding: 14px 16px; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; background: rgba(15, 23, 42, 0.5); color: #ffffff; font-size: 1rem; min-height: 200px; resize: vertical;"></textarea>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="includeUnsubscribe" checked style="width: 20px; height: 20px; cursor: pointer;">
                                <span>Include unsubscribe link</span>
                            </label>
                        </div>

                        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                            <div style="color: #06b6d4; font-weight: 600; margin-bottom: 5px;">üìä Email Preview</div>
                            <div style="color: #94a3b8; font-size: 0.9rem;">
                                <div>Recipients: <span id="recipientCount">0</span> users</div>
                                <div>Estimated delivery time: <span id="deliveryTime">Instant</span></div>
                            </div>
                        </div>

                        <button type="submit" class="save-btn">üì§ Send Bulk Email</button>
                    </form>
                </div>

                <!-- Email History -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Email History</h3>
                        <button class="refresh-btn" onclick="loadEmailHistory()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Subject</th>
                                <th>Recipients</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="emailHistoryTable">
                            <tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">‚úâÔ∏è</div><p>No emails sent yet</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Checklist Section -->
            <div id="checklistSection" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Checklist Downloads</h3>
                        <button class="refresh-btn" onclick="loadChecklistDownloads()">üîÑ Refresh</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Downloaded</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="checklistTable">
                            <tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üìã</div><p>No downloads yet</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="content-section">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Email Configuration</h3>
                        <form onsubmit="return saveEmailSettings(event)">
                            <div class="form-group">
                                <label>SMTP Host</label>
                                <input type="text" id="smtpHost" placeholder="smtp.gmail.com">
                            </div>
                            <div class="form-group">
                                <label>SMTP Port</label>
                                <input type="number" id="smtpPort" placeholder="587">
                            </div>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="emailAddress" placeholder="admin@bullbeartrading.com">
                            </div>
                            <div class="form-group">
                                <label>Email Password</label>
                                <input type="password" id="emailPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <button type="submit" class="save-btn">Save Email Settings</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>PayPal Configuration</h3>
                        <form onsubmit="return savePayPalSettings(event)">
                            <div class="form-group">
                                <label>PayPal.me Username</label>
                                <input type="text" id="paypalUsername" placeholder="megametahub42">
                            </div>
                            <div class="form-group">
                                <label>PayPal Client ID</label>
                                <input type="text" id="paypalClientId" placeholder="Your PayPal Client ID">
                            </div>
                            <div class="form-group">
                                <label>PayPal Secret</label>
                                <input type="password" id="paypalSecret" placeholder="Your PayPal Secret">
                            </div>
                            <button type="submit" class="save-btn">Save PayPal Settings</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>Site Configuration</h3>
                        <form onsubmit="return saveSiteSettings(event)">
                            <div class="form-group">
                                <label>Site Name</label>
                                <input type="text" id="siteName" value="BullBear Trading">
                            </div>
                            <div class="form-group">
                                <label>Site URL</label>
                                <input type="url" id="siteUrl" placeholder="https://bullbeartrading.com">
                            </div>
                            <div class="form-group">
                                <label>Support Email</label>
                                <input type="email" id="supportEmail" placeholder="support@bullbeartrading.com">
                            </div>
                            <button type="submit" class="save-btn">Save Site Settings</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>Security Settings</h3>
                        <form onsubmit="return saveSecuritySettings(event)">
                            <div class="form-group">
                                <label>Session Timeout (minutes)</label>
                                <input type="number" id="sessionTimeout" value="60">
                            </div>
                            <div class="form-group">
                                <label>Max Login Attempts</label>
                                <input type="number" id="maxLoginAttempts" value="5">
                            </div>
                            <button type="submit" class="save-btn">Save Security Settings</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="content-section">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profileAvatarLarge">A</div>
                    <div class="profile-details">
                        <h2 id="profileName">Admin User</h2>
                        <p id="profileEmail">admin@bullbeartrading.com</p>
                    </div>
                </div>

                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Personal Information</h3>
                        <form onsubmit="return saveProfile(event)">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="profileFullName" placeholder="Admin User">
                            </div>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="profileEmailInput" placeholder="admin@bullbeartrading.com">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" id="profilePhone" placeholder="+1 234 567 8900">
                            </div>
                            <button type="submit" class="save-btn">Update Profile</button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>Change Password</h3>
                        <form onsubmit="return changePassword(event)">
                            <div class="form-group">
                                <label>Current Password</label>
                                <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            </div>
                            <div class="form-group">
                                <label>New Password</label>
                                <input type="password" id="newPassword" placeholder="Enter new password" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" id="confirmNewPassword" placeholder="Confirm new password" required>
                            </div>
                            <button type="submit" class="save-btn">Change Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let authToken = null;
        let currentAdmin = null;
        let revenueChart, userChart, salesChart, monthlyRevenueChart, statusChart, registrationChart;

        // Check authentication on page load - MANUAL LOGIN REQUIRED
        window.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });

        function checkAuth() {
            // Always show login screen - no auto-login
            showLogin();
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
        }

        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            
            // Set admin info
            const email = currentAdmin.email || 'admin@bullbeartrading.com';
            const initial = email.charAt(0).toUpperCase();
            document.getElementById('adminName').textContent = email;
            document.getElementById('adminAvatar').textContent = initial;
            document.getElementById('profileAvatarLarge').textContent = initial;
            document.getElementById('profileName').textContent = email;
            document.getElementById('profileEmail').textContent = email;
            document.getElementById('profileFullName').value = email;
            document.getElementById('profileEmailInput').value = email;

            // Load initial data
            loadDashboardData();
            initCharts();
            
            // Start live time
            updateLiveTime();
            setInterval(updateLiveTime, 1000);
            
            // Get user location
            getUserLocation();
        }

        // Live Time Function
        function updateLiveTime() {
            const now = new Date();
            
            // Format time
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('liveTime').textContent = `${hours}:${minutes}:${seconds}`;
            
            // Format date
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            document.getElementById('liveDate').textContent = now.toLocaleDateString('en-US', options);
        }

        // Get User Location
        function getUserLocation() {
            // Try multiple location APIs for better reliability
            
            // Method 1: ipapi.co
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    if (data.city && data.country_name) {
                        const location = `${data.city}, ${data.country_name}`;
                        document.getElementById('userLocation').textContent = location;
                        
                        // Store location data
                        localStorage.setItem('adminLocation', JSON.stringify({
                            city: data.city,
                            region: data.region,
                            country: data.country_name,
                            countryCode: data.country_code,
                            ip: data.ip,
                            timezone: data.timezone,
                            latitude: data.latitude,
                            longitude: data.longitude
                        }));
                    } else {
                        tryAlternativeLocationAPI();
                    }
                })
                .catch(error => {
                    console.error('ipapi.co failed:', error);
                    tryAlternativeLocationAPI();
                });
        }

        // Alternative location detection
        function tryAlternativeLocationAPI() {
            // Method 2: ip-api.com
            fetch('http://ip-api.com/json/')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const location = `${data.city}, ${data.country}`;
                        document.getElementById('userLocation').textContent = location;
                        
                        localStorage.setItem('adminLocation', JSON.stringify({
                            city: data.city,
                            region: data.regionName,
                            country: data.country,
                            countryCode: data.countryCode,
                            ip: data.query,
                            timezone: data.timezone,
                            latitude: data.lat,
                            longitude: data.lon
                        }));
                    } else {
                        tryBrowserGeolocation();
                    }
                })
                .catch(error => {
                    console.error('ip-api.com failed:', error);
                    tryBrowserGeolocation();
                });
        }

        // Browser geolocation as last resort
        function tryBrowserGeolocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        // Use reverse geocoding to get city name
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`)
                            .then(response => response.json())
                            .then(data => {
                                const city = data.address.city || data.address.town || data.address.village || 'Unknown';
                                const country = data.address.country || 'Unknown';
                                document.getElementById('userLocation').textContent = `${city}, ${country}`;
                                
                                localStorage.setItem('adminLocation', JSON.stringify({
                                    city: city,
                                    country: country,
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude
                                }));
                            })
                            .catch(error => {
                                console.error('Reverse geocoding failed:', error);
                                document.getElementById('userLocation').textContent = 'Location detected';
                            });
                    },
                    error => {
                        console.error('Geolocation failed:', error);
                        document.getElementById('userLocation').textContent = 'Enable location';
                    }
                );
            } else {
                document.getElementById('userLocation').textContent = 'Not supported';
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            // Default credentials
            if (email === 'admin@bullbeartrading.com' && password === 'Admin@2025!') {
                const adminData = {
                    email: email,
                    token: 'admin-token-' + Date.now(),
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('bullbearAdmin', JSON.stringify(adminData));
                currentAdmin = adminData;
                authToken = adminData.token;
                
                showDashboard();
            } else {
                errorDiv.textContent = '‚ùå Invalid email or password';
                errorDiv.style.display = 'block';
            }

            return false;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('bullbearAdmin');
                currentAdmin = null;
                authToken = null;
                showLogin();
            }
        }

        function showSection(sectionName) {
            // Update menu
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Update page title
            const titles = {
                'dashboard': { title: 'Dashboard Overview', subtitle: "Welcome back! Here's what's happening today." },
                'analytics': { title: 'Analytics & Reports', subtitle: 'Detailed insights into your platform performance.' },
                'purchases': { title: 'Purchase Management', subtitle: 'View and manage all course purchases.' },
                'users': { title: 'User Management', subtitle: 'Manage registered users and their activities.' },
                'content': { title: 'Content Management', subtitle: 'Manage videos, ebooks, and documents.' },
                'emails': { title: 'Bulk Email Sender', subtitle: 'Send emails to multiple users at once.' },
                'checklist': { title: 'Checklist Downloads', subtitle: 'Track free checklist downloads and signups.' },
                'settings': { title: 'Platform Settings', subtitle: 'Configure email, PayPal, and site settings.' },
                'profile': { title: 'Admin Profile', subtitle: 'Manage your account and security settings.' }
            };

            document.getElementById('pageTitle').textContent = titles[sectionName].title;
            document.getElementById('pageSubtitle').textContent = titles[sectionName].subtitle;
            document.getElementById(sectionName + 'Section').classList.add('active');

            // Load section data
            if (sectionName === 'dashboard') loadDashboardData();
            else if (sectionName === 'analytics') loadAnalytics();
            else if (sectionName === 'purchases') loadPurchases();
            else if (sectionName === 'users') loadUsers();
            else if (sectionName === 'content') loadContent();
            else if (sectionName === 'emails') loadEmailSection();
            else if (sectionName === 'checklist') loadChecklistDownloads();
        }

        // Get all purchases from localStorage
        function getAllPurchases() {
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');
            let allPurchases = [];

            users.forEach(user => {
                const userPurchases = JSON.parse(localStorage.getItem('metahubPurchases_' + user.email) || '[]');
                userPurchases.forEach(purchase => {
                    allPurchases.push({
                        ...purchase,
                        userEmail: user.email,
                        userName: user.name
                    });
                });
            });

            return allPurchases;
        }

        // Load dashboard data
        function loadDashboardData() {
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');
            const purchases = getAllPurchases();
            const pending = purchases.filter(p => p.status === 'pending').length;
            const revenue = purchases.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalPurchases').textContent = purchases.length;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('totalRevenue').textContent = '$' + revenue.toFixed(2);

            // Load recent purchases
            const recentPurchases = purchases.slice(-5).reverse();
            const tbody = document.getElementById('recentPurchasesTable');
            
            if (recentPurchases.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üì¶</div><p>No recent purchases</p></div></td></tr>';
            } else {
                tbody.innerHTML = recentPurchases.map(purchase => `
                    <tr>
                        <td>${purchase.userName || purchase.userEmail}</td>
                        <td>${purchase.courseTitle || purchase.courseId || 'Course'}</td>
                        <td>$${purchase.amount || 0}</td>
                        <td>${new Date(purchase.purchaseDate || purchase.createdAt).toLocaleDateString()}</td>
                        <td><span class="status-badge status-${purchase.status || 'pending'}">${purchase.status || 'pending'}</span></td>
                    </tr>
                `).join('');
            }

            updateCharts();
        }

        // Initialize charts
        function initCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [1200, 1900, 3000, 5000, 4000, 6000],
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } },
                        x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } }
                    }
                }
            });

            // User Chart
            const userCtx = document.getElementById('userChart').getContext('2d');
            userChart = new Chart(userCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'New Users',
                        data: [12, 19, 30, 50, 40, 60],
                        backgroundColor: 'rgba(99, 102, 241, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } },
                        x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } }
                    }
                }
            });
        }

        function updateCharts() {
            // Update with real data if needed
            if (revenueChart) revenueChart.update();
            if (userChart) userChart.update();
        }

        // Load analytics
        function loadAnalytics() {
            // Sales by Course Chart
            if (!salesChart) {
                const salesCtx = document.getElementById('salesChart').getContext('2d');
                salesChart = new Chart(salesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Crypto Trading', 'Technical Analysis', 'Risk Management', 'Trading Psychology'],
                        datasets: [{
                            data: [30, 25, 20, 25],
                            backgroundColor: ['#6366f1', '#06b6d4', '#8b5cf6', '#10b981']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { labels: { color: '#94a3b8' } } }
                    }
                });
            }

            // Monthly Revenue Chart
            if (!monthlyRevenueChart) {
                const monthlyCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
                monthlyRevenueChart = new Chart(monthlyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Revenue',
                            data: [1200, 1900, 3000, 5000, 4000, 6000, 7500, 8200, 9000, 10500, 11000, 12500],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { labels: { color: '#94a3b8' } } },
                        scales: {
                            y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } },
                            x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } }
                        }
                    }
                });
            }

            // Status Distribution Chart
            if (!statusChart) {
                const statusCtx = document.getElementById('statusChart').getContext('2d');
                statusChart = new Chart(statusCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Approved', 'Pending', 'Rejected'],
                        datasets: [{
                            data: [65, 25, 10],
                            backgroundColor: ['#10b981', '#fbbf24', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { labels: { color: '#94a3b8' } } }
                    }
                });
            }

            // Registration Chart
            if (!registrationChart) {
                const regCtx = document.getElementById('registrationChart').getContext('2d');
                registrationChart = new Chart(regCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Registrations',
                            data: [15, 22, 18, 30],
                            backgroundColor: 'rgba(139, 92, 246, 0.8)'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { labels: { color: '#94a3b8' } } },
                        scales: {
                            y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } },
                            x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(99, 102, 241, 0.1)' } }
                        }
                    }
                });
            }
        }

        // Load purchases
        function loadPurchases() {
            const tbody = document.getElementById('purchasesTable');
            const purchases = getAllPurchases();

            if (purchases.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üõí</div><p>No purchases yet</p></div></td></tr>';
                return;
            }

            tbody.innerHTML = purchases.map(purchase => `
                <tr>
                    <td>${purchase.orderId || 'N/A'}</td>
                    <td>${purchase.userName || purchase.userEmail}</td>
                    <td>${purchase.courseTitle || purchase.courseId || 'Course'}</td>
                    <td>$${purchase.amount || 0}</td>
                    <td>${new Date(purchase.purchaseDate || purchase.createdAt).toLocaleDateString()}</td>
                    <td><span class="status-badge status-${purchase.status || 'pending'}">${purchase.status || 'pending'}</span></td>
                    <td>
                        ${purchase.status === 'pending' ? `
                            <button class="action-btn btn-approve" onclick="approvePurchase('${purchase.userEmail}', '${purchase.orderId}')">‚úì Approve</button>
                            <button class="action-btn btn-reject" onclick="rejectPurchase('${purchase.userEmail}', '${purchase.orderId}')">‚úó Reject</button>
                        ` : `
                            <button class="action-btn btn-view" onclick="viewPurchase('${purchase.userEmail}', '${purchase.orderId}')">üëÅ View</button>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function approvePurchase(userEmail, orderId) {
            if (!confirm('Approve this purchase?')) return;

            const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + userEmail) || '[]');
            const purchase = purchases.find(p => p.orderId === orderId);
            if (purchase) {
                purchase.status = 'approved';
                localStorage.setItem('metahubPurchases_' + userEmail, JSON.stringify(purchases));
                loadPurchases();
                loadDashboardData();
                alert('‚úÖ Purchase approved!');
            }
        }

        function rejectPurchase(userEmail, orderId) {
            if (!confirm('Reject this purchase?')) return;

            const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + userEmail) || '[]');
            const purchase = purchases.find(p => p.orderId === orderId);
            if (purchase) {
                purchase.status = 'rejected';
                localStorage.setItem('metahubPurchases_' + userEmail, JSON.stringify(purchases));
                loadPurchases();
                loadDashboardData();
                alert('‚ùå Purchase rejected');
            }
        }

        function viewPurchase(userEmail, orderId) {
            const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + userEmail) || '[]');
            const purchase = purchases.find(p => p.orderId === orderId);
            if (purchase) {
                alert(JSON.stringify(purchase, null, 2));
            }
        }

        // Load users
        function loadUsers() {
            const tbody = document.getElementById('usersTable');
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');

            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üë•</div><p>No users yet</p></div></td></tr>';
                return;
            }

            tbody.innerHTML = users.map(user => {
                const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + user.email) || '[]');
                return `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>${purchases.length}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewUser('${user.email}')">üëÅ View</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function viewUser(email) {
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');
            const user = users.find(u => u.email === email);
            if (user) {
                alert(JSON.stringify(user, null, 2));
            }
        }

        // Load checklist downloads
        function loadChecklistDownloads() {
            const tbody = document.getElementById('checklistTable');
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');

            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üìã</div><p>No downloads yet</p></div></td></tr>';
                return;
            }

            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || 'N/A'}</td>
                    <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewUser('${user.email}')">üëÅ View</button>
                    </td>
                </tr>
            `).join('');
        }

        // Settings functions
        function saveEmailSettings(event) {
            event.preventDefault();
            const settings = {
                smtpHost: document.getElementById('smtpHost').value,
                smtpPort: document.getElementById('smtpPort').value,
                emailAddress: document.getElementById('emailAddress').value,
                emailPassword: document.getElementById('emailPassword').value
            };
            localStorage.setItem('bullbearEmailSettings', JSON.stringify(settings));
            alert('‚úÖ Email settings saved successfully!');
            return false;
        }

        function savePayPalSettings(event) {
            event.preventDefault();
            const settings = {
                paypalUsername: document.getElementById('paypalUsername').value,
                paypalClientId: document.getElementById('paypalClientId').value,
                paypalSecret: document.getElementById('paypalSecret').value
            };
            localStorage.setItem('bullbearPayPalSettings', JSON.stringify(settings));
            alert('‚úÖ PayPal settings saved successfully!');
            return false;
        }

        function saveSiteSettings(event) {
            event.preventDefault();
            const settings = {
                siteName: document.getElementById('siteName').value,
                siteUrl: document.getElementById('siteUrl').value,
                supportEmail: document.getElementById('supportEmail').value
            };
            localStorage.setItem('bullbearSiteSettings', JSON.stringify(settings));
            alert('‚úÖ Site settings saved successfully!');
            return false;
        }

        function saveSecuritySettings(event) {
            event.preventDefault();
            const settings = {
                sessionTimeout: document.getElementById('sessionTimeout').value,
                maxLoginAttempts: document.getElementById('maxLoginAttempts').value
            };
            localStorage.setItem('bullbearSecuritySettings', JSON.stringify(settings));
            alert('‚úÖ Security settings saved successfully!');
            return false;
        }

        // Profile functions
        function saveProfile(event) {
            event.preventDefault();
            const profile = {
                fullName: document.getElementById('profileFullName').value,
                email: document.getElementById('profileEmailInput').value,
                phone: document.getElementById('profilePhone').value
            };
            
            // Update current admin
            currentAdmin.email = profile.email;
            currentAdmin.name = profile.fullName;
            currentAdmin.phone = profile.phone;
            localStorage.setItem('bullbearAdmin', JSON.stringify(currentAdmin));
            
            // Update display
            document.getElementById('adminName').textContent = profile.email;
            document.getElementById('profileName').textContent = profile.fullName || profile.email;
            document.getElementById('profileEmail').textContent = profile.email;
            
            alert('‚úÖ Profile updated successfully!');
            return false;
        }

        function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (newPassword !== confirmNewPassword) {
                alert('‚ùå New passwords do not match!');
                return false;
            }

            if (newPassword.length < 6) {
                alert('‚ùå Password must be at least 6 characters!');
                return false;
            }

            // In production, verify current password against stored hash
            alert('‚úÖ Password changed successfully!');
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            
            return false;
        }

        // Load saved settings on page load
        function loadSettings() {
            // Load email settings
            const emailSettings = JSON.parse(localStorage.getItem('bullbearEmailSettings') || '{}');
            if (emailSettings.smtpHost) document.getElementById('smtpHost').value = emailSettings.smtpHost;
            if (emailSettings.smtpPort) document.getElementById('smtpPort').value = emailSettings.smtpPort;
            if (emailSettings.emailAddress) document.getElementById('emailAddress').value = emailSettings.emailAddress;

            // Load PayPal settings
            const paypalSettings = JSON.parse(localStorage.getItem('bullbearPayPalSettings') || '{}');
            if (paypalSettings.paypalUsername) document.getElementById('paypalUsername').value = paypalSettings.paypalUsername;
            if (paypalSettings.paypalClientId) document.getElementById('paypalClientId').value = paypalSettings.paypalClientId;

            // Load site settings
            const siteSettings = JSON.parse(localStorage.getItem('bullbearSiteSettings') || '{}');
            if (siteSettings.siteName) document.getElementById('siteName').value = siteSettings.siteName;
            if (siteSettings.siteUrl) document.getElementById('siteUrl').value = siteSettings.siteUrl;
            if (siteSettings.supportEmail) document.getElementById('supportEmail').value = siteSettings.supportEmail;

            // Load security settings
            const securitySettings = JSON.parse(localStorage.getItem('bullbearSecuritySettings') || '{}');
            if (securitySettings.sessionTimeout) document.getElementById('sessionTimeout').value = securitySettings.sessionTimeout;
            if (securitySettings.maxLoginAttempts) document.getElementById('maxLoginAttempts').value = securitySettings.maxLoginAttempts;
        }

        // Content Management Functions
        let currentContentFilter = 'all';

        function addContent(event) {
            event.preventDefault();

            const content = {
                id: 'content_' + Date.now(),
                type: document.getElementById('contentType').value,
                title: document.getElementById('contentTitle').value,
                description: document.getElementById('contentDescription').value,
                url: document.getElementById('contentUrl').value,
                category: document.getElementById('contentCategory').value,
                duration: document.getElementById('contentDuration').value,
                addedDate: new Date().toISOString()
            };

            // Get existing content
            const contentList = JSON.parse(localStorage.getItem('bullbearContent') || '[]');
            contentList.push(content);
            localStorage.setItem('bullbearContent', JSON.stringify(contentList));

            // Clear form
            document.getElementById('contentTitle').value = '';
            document.getElementById('contentDescription').value = '';
            document.getElementById('contentUrl').value = '';
            document.getElementById('contentCategory').value = '';
            document.getElementById('contentDuration').value = '';

            alert('‚úÖ Content added successfully!');
            loadContent();

            return false;
        }

        function loadContent() {
            const tbody = document.getElementById('contentTable');
            const contentList = JSON.parse(localStorage.getItem('bullbearContent') || '[]');

            // Filter content
            let filteredContent = contentList;
            if (currentContentFilter !== 'all') {
                filteredContent = contentList.filter(c => c.type === currentContentFilter);
            }

            if (filteredContent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üìö</div><p>No content found. Add your first video, ebook, or document!</p></div></td></tr>';
                return;
            }

            const typeIcons = {
                'video': 'üé•',
                'ebook': 'üìñ',
                'document': 'üìÑ'
            };

            tbody.innerHTML = filteredContent.map(content => `
                <tr>
                    <td>${typeIcons[content.type]} ${content.type.charAt(0).toUpperCase() + content.type.slice(1)}</td>
                    <td><strong>${content.title}</strong><br><small style="color: #94a3b8;">${content.description || 'No description'}</small></td>
                    <td>${content.category || 'Uncategorized'}</td>
                    <td>${content.duration || 'N/A'}</td>
                    <td>${new Date(content.addedDate).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewContent('${content.id}')">üëÅ View</button>
                        <button class="action-btn btn-edit" onclick="editContent('${content.id}')">‚úèÔ∏è Edit</button>
                        <button class="action-btn btn-reject" onclick="deleteContent('${content.id}')">üóëÔ∏è Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterContent(type) {
            currentContentFilter = type;
            
            // Update tab styling
            const tabs = document.querySelectorAll('#contentSection .tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.style.color = '#94a3b8';
                tab.style.borderBottomColor = 'transparent';
            });
            event.target.classList.add('active');
            event.target.style.color = '#06b6d4';
            event.target.style.borderBottomColor = '#06b6d4';

            loadContent();
        }

        function viewContent(contentId) {
            const contentList = JSON.parse(localStorage.getItem('bullbearContent') || '[]');
            const content = contentList.find(c => c.id === contentId);
            
            if (content) {
                const details = `
üìö Content Details

Type: ${content.type.toUpperCase()}
Title: ${content.title}
Description: ${content.description || 'N/A'}
Category: ${content.category || 'Uncategorized'}
Duration/Pages: ${content.duration || 'N/A'}
URL: ${content.url}
Added: ${new Date(content.addedDate).toLocaleString()}
                `;
                alert(details);
            }
        }

        function editContent(contentId) {
            const contentList = JSON.parse(localStorage.getItem('bullbearContent') || '[]');
            const content = contentList.find(c => c.id === contentId);
            
            if (content) {
                const newTitle = prompt('Edit Title:', content.title);
                if (newTitle && newTitle !== content.title) {
                    content.title = newTitle;
                    localStorage.setItem('bullbearContent', JSON.stringify(contentList));
                    loadContent();
                    alert('‚úÖ Content updated!');
                }
            }
        }

        function deleteContent(contentId) {
            if (!confirm('Are you sure you want to delete this content?')) return;

            let contentList = JSON.parse(localStorage.getItem('bullbearContent') || '[]');
            contentList = contentList.filter(c => c.id !== contentId);
            localStorage.setItem('bullbearContent', JSON.stringify(contentList));
            
            loadContent();
            alert('üóëÔ∏è Content deleted!');
        }

        // Bulk Email Functions
        function loadEmailSection() {
            updateRecipientCount();
            loadEmailHistory();

            // Show/hide custom emails field
            document.getElementById('emailRecipients').addEventListener('change', function() {
                const customGroup = document.getElementById('customEmailsGroup');
                if (this.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
                updateRecipientCount();
            });
        }

        function updateRecipientCount() {
            const recipientType = document.getElementById('emailRecipients').value;
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');
            let count = 0;

            if (recipientType === 'all') {
                count = users.length;
            } else if (recipientType === 'buyers') {
                count = users.filter(user => {
                    const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + user.email) || '[]');
                    return purchases.length > 0;
                }).length;
            } else if (recipientType === 'checklist') {
                count = users.length; // All users who signed up for checklist
            } else if (recipientType === 'custom') {
                const customEmails = document.getElementById('customEmails').value;
                if (customEmails.trim()) {
                    count = customEmails.split(',').filter(e => e.trim()).length;
                }
            }

            document.getElementById('recipientCount').textContent = count;
            
            // Update delivery time estimate
            const deliveryTime = count <= 10 ? 'Instant' : count <= 50 ? '~1 minute' : count <= 100 ? '~2-3 minutes' : '~5 minutes';
            document.getElementById('deliveryTime').textContent = deliveryTime;
        }

        function sendBulkEmail(event) {
            event.preventDefault();

            const recipientType = document.getElementById('emailRecipients').value;
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailMessage').value;
            const includeUnsubscribe = document.getElementById('includeUnsubscribe').checked;

            // Get recipient emails
            let recipientEmails = [];
            const users = JSON.parse(localStorage.getItem('bullbearUsers') || '[]');

            if (recipientType === 'all') {
                recipientEmails = users.map(u => u.email);
            } else if (recipientType === 'buyers') {
                recipientEmails = users.filter(user => {
                    const purchases = JSON.parse(localStorage.getItem('metahubPurchases_' + user.email) || '[]');
                    return purchases.length > 0;
                }).map(u => u.email);
            } else if (recipientType === 'checklist') {
                recipientEmails = users.map(u => u.email);
            } else if (recipientType === 'custom') {
                const customEmails = document.getElementById('customEmails').value;
                recipientEmails = customEmails.split(',').map(e => e.trim()).filter(e => e);
            }

            if (recipientEmails.length === 0) {
                alert('‚ùå No recipients found!');
                return false;
            }

            // Confirm send
            if (!confirm(`Send email to ${recipientEmails.length} recipients?\n\nSubject: ${subject}`)) {
                return false;
            }

            // Create email record
            const emailRecord = {
                id: 'email_' + Date.now(),
                date: new Date().toISOString(),
                subject: subject,
                message: message,
                recipientType: recipientType,
                recipientCount: recipientEmails.length,
                recipients: recipientEmails,
                includeUnsubscribe: includeUnsubscribe,
                status: 'sent'
            };

            // Save to history
            const emailHistory = JSON.parse(localStorage.getItem('bullbearEmailHistory') || '[]');
            emailHistory.unshift(emailRecord);
            localStorage.setItem('bullbearEmailHistory', JSON.stringify(emailHistory));

            // In production, this would call the backend API to send emails
            // For now, we'll simulate the send
            console.log('Sending bulk email:', emailRecord);

            // Clear form
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailMessage').value = '';
            document.getElementById('customEmails').value = '';

            alert(`‚úÖ Email sent successfully to ${recipientEmails.length} recipients!`);
            loadEmailHistory();

            return false;
        }

        function loadEmailHistory() {
            const tbody = document.getElementById('emailHistoryTable');
            const emailHistory = JSON.parse(localStorage.getItem('bullbearEmailHistory') || '[]');

            if (emailHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">‚úâÔ∏è</div><p>No emails sent yet</p></div></td></tr>';
                return;
            }

            tbody.innerHTML = emailHistory.slice(0, 20).map(email => `
                <tr>
                    <td>${new Date(email.date).toLocaleString()}</td>
                    <td><strong>${email.subject}</strong></td>
                    <td>${email.recipientCount} users</td>
                    <td><span class="status-badge status-approved">${email.status}</span></td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewEmail('${email.id}')">üëÅ View</button>
                        <button class="action-btn btn-reject" onclick="deleteEmail('${email.id}')">üóëÔ∏è Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function viewEmail(emailId) {
            const emailHistory = JSON.parse(localStorage.getItem('bullbearEmailHistory') || '[]');
            const email = emailHistory.find(e => e.id === emailId);
            
            if (email) {
                const details = `
üìß Email Details

Date: ${new Date(email.date).toLocaleString()}
Subject: ${email.subject}
Recipients: ${email.recipientCount} users (${email.recipientType})
Status: ${email.status}

Message:
${email.message}

Unsubscribe Link: ${email.includeUnsubscribe ? 'Yes' : 'No'}
                `;
                alert(details);
            }
        }

        function deleteEmail(emailId) {
            if (!confirm('Delete this email from history?')) return;

            let emailHistory = JSON.parse(localStorage.getItem('bullbearEmailHistory') || '[]');
            emailHistory = emailHistory.filter(e => e.id !== emailId);
            localStorage.setItem('bullbearEmailHistory', JSON.stringify(emailHistory));
            
            loadEmailHistory();
            alert('üóëÔ∏è Email deleted from history!');
        }

        // Call loadSettings when dashboard is shown
        setTimeout(loadSettings, 500);
    </script>
</body>
</html>
